# AIæ–‡æœ¬è½¬æ¢å·¥å…· - æŠ€æœ¯æ¶æ„æ–¹æ¡ˆ

## ä¸€ã€æ¦‚è¿°ä¸æ ¸å¿ƒå®šä½

### 1.1 åŠŸèƒ½å®šä½

**è¿™æ˜¯ä¸€ä¸ªæ ¼å¼è½¬æ¢å·¥å…·ï¼Œè€ŒéAIåˆ›ä½œåŠ©æ‰‹ã€‚**

- âŒ **ä¸æ˜¯**ï¼šè®©AIå¸®ä½ åˆ›ä½œå¡ç‰Œå†…å®¹
- âœ… **æ˜¯**ï¼šå°†ä½ å·²ç»å†™å¥½çš„å®Œæ•´æ–‡æœ¬è½¬æ¢ä¸ºJSONæ ¼å¼

**æ ¸å¿ƒåŸåˆ™ï¼š**
- AIåªè´Ÿè´£**è¯†åˆ«æ ¼å¼**å’Œ**å­—æ®µæ˜ å°„**
- ä¸æ·»åŠ ä»»ä½•åˆ›æ„æ€§å†…å®¹
- 100%è¿˜åŸç”¨æˆ·åŸæ–‡
- é‡åˆ°ä¸ç¡®å®šæ—¶æŠ¥é”™ï¼Œè€ŒéçŒœæµ‹

### 1.2 ç›®æ ‡ç”¨æˆ·åœºæ™¯

1. ç”¨æˆ·å·²åœ¨Word/è®°äº‹æœ¬/Markdownä¸­å†™å¥½å®Œæ•´çš„å¡ç‰Œå†…å®¹
2. ç”¨æˆ·æœ‰ç°æˆçš„è®¾å®šæ–‡æ¡£éœ€è¦å¯¼å…¥
3. ç”¨æˆ·æƒ³ä»å…¶ä»–æ ¼å¼å¿«é€Ÿè½¬æ¢ä¸ºå¡åŒ…JSON

### 1.3 æŠ€æœ¯çº¦æŸ

- **å¿…é¡»**å…¼å®¹æ‰€æœ‰OpenAIæ ¼å¼çš„APIï¼ˆä¸ä¾èµ–Anthropicç‰¹æœ‰åŠŸèƒ½ï¼‰
- **å¿…é¡»**æ”¯æŒå¤šç§AIæä¾›å•†ï¼ˆOpenAIã€Claudeã€å›½äº§æ¨¡å‹ç­‰ï¼‰
- **å¿…é¡»**å¤„ç†å¤§é‡æ–‡æœ¬ï¼ˆå¯èƒ½å‡ ä¸‡å­—ï¼‰
- **å¿…é¡»**æä¾›æ¸…æ™°çš„è¿›åº¦åé¦ˆ

---

## äºŒã€æ ¸å¿ƒæ¶æ„è®¾è®¡

### 2.1 æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ç”¨æˆ·è¾“å…¥å±‚                              â”‚
â”‚  - ç²˜è´´æ–‡æœ¬ï¼ˆ.txt, .mdï¼‰                                     â”‚
â”‚  - ä¸Šä¼ æ–‡ä»¶                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   æ–‡ä»¶å¤„ç†å±‚                                 â”‚
â”‚  FileProcessor: æå–çº¯æ–‡æœ¬                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              æµå¼æ‰¹é‡å¤„ç†åè°ƒå™¨                              â”‚
â”‚  StreamingBatchProcessor                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  while (æœªå¤„ç†å®Œ) {                              â”‚        â”‚
â”‚  â”‚    1. æå–æ–‡æœ¬çª—å£ï¼ˆ6000å­—ç¬¦ + 200é‡å ï¼‰        â”‚        â”‚
â”‚  â”‚    2. è°ƒç”¨AIå¤„ç†                                 â”‚        â”‚
â”‚  â”‚    3. AIè¿”å› {cards, processedUpTo}             â”‚        â”‚
â”‚  â”‚    4. JSONåˆå¹¶ï¼ˆçº¯å‡½æ•°ï¼‰                         â”‚        â”‚
â”‚  â”‚    5. æ›´æ–°ä½ç½®ï¼Œç»§ç»­å¾ªç¯                         â”‚        â”‚
â”‚  â”‚  }                                               â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚            â”‚            â”‚
          â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚AIæœåŠ¡å±‚ â”‚  â”‚åˆå¹¶å‡½æ•° â”‚  â”‚éªŒè¯æœåŠ¡  â”‚
    â”‚OpenAI   â”‚  â”‚(çº¯å‡½æ•°) â”‚  â”‚ç°æœ‰çš„    â”‚
    â”‚å…¼å®¹API  â”‚  â”‚å¯æµ‹è¯•   â”‚  â”‚validator â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚            â”‚            â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    UIé¢„è§ˆå±‚                                  â”‚
â”‚  - åˆ†å¡ç‰Œç±»å‹å±•ç¤º                                            â”‚
â”‚  - å¯å‹¾é€‰ã€å¯ç¼–è¾‘                                            â”‚
â”‚  - è­¦å‘Š/é”™è¯¯å¯è§†åŒ–                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 å¯¼å…¥åˆ°ç¼–è¾‘å™¨                                 â”‚
â”‚  CardEditorStore: åˆå¹¶åˆ°ç°æœ‰å¡åŒ…                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 æ ¸å¿ƒæ¨¡å—èŒè´£

| æ¨¡å— | èŒè´£ | ä¾èµ– |
|------|------|------|
| FileProcessor | æå–çº¯æ–‡æœ¬ï¼ˆ.txt/.mdï¼‰ | - |
| StreamingBatchProcessor | æµå¼åˆ†å—å¤„ç†åè°ƒ | AIService, JSONMerger |
| AIService | OpenAIå…¼å®¹APIè°ƒç”¨ | fetch |
| JSONMerger | å¡åŒ…æ•°æ®åˆå¹¶ï¼ˆçº¯å‡½æ•°ï¼‰ | - |
| ResultParser | è§£æAIè¾“å‡ºï¼Œæå–è­¦å‘Š | ValidationService |
| ValidationService | æ•°æ®éªŒè¯ï¼ˆç°æœ‰ï¼‰ | - |

---

## ä¸‰ã€å…³é”®æ¨¡å—è¯¦ç»†è®¾è®¡

### 3.1 JSONåˆå¹¶å‡½æ•°ï¼ˆçº¯å‡½æ•°ï¼Œå¯æµ‹è¯•ï¼‰

**æ–‡ä»¶ï¼š** `app/card-editor/services/json-merger.ts`

```typescript
interface MergeOptions {
  deduplicateById?: boolean  // æ˜¯å¦æŒ‰IDå»é‡
  conflictStrategy?: 'overwrite' | 'keep_existing' | 'merge'
}

/**
 * åˆå¹¶ä¸¤ä¸ªCardPackageStateï¼Œçº¯å‡½æ•°å®ç°
 * @param existing ç°æœ‰çš„å¡åŒ…æ•°æ®
 * @param incoming AIç”Ÿæˆçš„æ–°æ•°æ®
 * @param options åˆå¹¶é€‰é¡¹
 * @returns åˆå¹¶åçš„å¡åŒ…æ•°æ®
 */
function mergeCardData(
  existing: CardPackageState,
  incoming: Partial<CardPackageState>,
  options: MergeOptions = {
    deduplicateById: true,
    conflictStrategy: 'merge'
  }
): CardPackageState
```

**æ ¸å¿ƒé€»è¾‘ï¼š**

1. **customFieldDefinitionsåˆå¹¶**
   - å»é‡ï¼šä½¿ç”¨Setè‡ªåŠ¨å»é‡
   - ä¿æŒé¡ºåºï¼šå…ˆexistingï¼Œåincoming

2. **å¡ç‰Œæ•°ç»„åˆå¹¶**
   - æŒ‰IDå»é‡ï¼ˆå¯é€‰ï¼‰
   - å†²çªç­–ç•¥ï¼š
     - `overwrite`: æ–°å€¼è¦†ç›–æ—§å€¼
     - `keep_existing`: ä¿ç•™æ—§å€¼
     - `merge`: å­—æ®µçº§åˆå¹¶ï¼ˆæ–°å€¼å¡«å……ç©ºå­—æ®µï¼‰

3. **å…ƒæ•°æ®å¤„ç†**
   - name/version/authorï¼šä¼˜å…ˆä½¿ç”¨incomingï¼ˆå¦‚æœæä¾›ï¼‰

**å•å…ƒæµ‹è¯•è¦†ç›–ï¼š**
- âœ… IDå»é‡
- âœ… customFieldDefinitionså»é‡
- âœ… å†²çªç­–ç•¥éªŒè¯
- âœ… è¾¹ç•Œæƒ…å†µï¼ˆç©ºæ•°ç»„ã€undefinedå­—æ®µï¼‰

---

### 3.2 AIæœåŠ¡å±‚ï¼ˆOpenAIå…¼å®¹ï¼‰

**æ–‡ä»¶ï¼š** `app/card-editor/services/ai-service.ts`

```typescript
interface AIServiceConfig {
  apiKey: string
  baseURL: string  // å¯é…ç½®ï¼Œæ”¯æŒå¤šç§æä¾›å•†
  model: string
  maxTokens?: number
}

interface AIChunkResponse {
  cards: any[]  // è¿™æ¬¡å¤„ç†çš„å¡ç‰ŒJSONæ•°ç»„
  metadata: {
    processedUpTo: number      // å¤„ç†åˆ°åŸæ–‡ç¬¬å‡ ä¸ªå­—ç¬¦
    lastProcessedText: string  // æœ€åå¤„ç†çš„5-10ä¸ªå­—
    nextShouldStartFrom?: number  // å»ºè®®ä¸‹æ¬¡ä»å“ªå¼€å§‹ï¼ˆå¯é€‰ï¼‰
    confidence: 'complete' | 'partial'  // æ˜¯å¦å®Œæ•´å¤„ç†
  }
}

class AIService {
  private config: AIServiceConfig

  /**
   * ç”Ÿæˆå¹¶è¿”å›ç»“æ„åŒ–å“åº”
   * ä½¿ç”¨OpenAI Chat Completionsæ ¼å¼
   */
  async generateWithMetadata(
    prompt: string,
    packageContext: CardPackageState
  ): Promise<AIChunkResponse>
}
```

**å®ç°è¦ç‚¹ï¼š**

1. **å®Œå…¨ä½¿ç”¨OpenAIæ ¼å¼**
   ```typescript
   const response = await fetch(`${baseURL}/chat/completions`, {
     method: 'POST',
     headers: {
       'Content-Type': 'application/json',
       'Authorization': `Bearer ${apiKey}`
     },
     body: JSON.stringify({
       model: this.config.model,
       messages: [
         { role: 'system', content: systemPrompt },
         { role: 'user', content: userPrompt }
       ],
       temperature: 0.1,  // ä½æ¸©åº¦ç¡®ä¿ä¸¥æ ¼éµå®ˆæ ¼å¼
       response_format: { type: 'json_object' }  // å¼ºåˆ¶JSONè¾“å‡º
     })
   })
   ```

2. **æ”¯æŒå¤šæä¾›å•†**
   - OpenAI: `https://api.openai.com/v1`
   - Claude (OpenAIå…¼å®¹): `https://api.anthropic.com/v1`
   - è‡ªå®šä¹‰: ç”¨æˆ·æä¾›çš„baseURL

3. **ä¸ä¾èµ–ç‰¹æ®ŠåŠŸèƒ½**
   - âŒ ä¸ä½¿ç”¨Anthropicçš„prompt caching
   - âŒ ä¸ä½¿ç”¨Extended Thinking
   - âœ… ä»…ä½¿ç”¨æ ‡å‡†çš„Chat Completionsæ¥å£

---

### 3.3 æ»‘åŠ¨çª—å£ + AIè‡ªä¸»åˆ†èŠ‚

**æ–‡ä»¶ï¼š** `app/card-editor/services/streaming-batch-processor.ts`

**æ ¸å¿ƒæœºåˆ¶ï¼š**

```typescript
class StreamingBatchProcessor {
  private WINDOW_SIZE = 6000  // æ¯æ¬¡ç»™AIçº¦6000å­—ç¬¦
  private OVERLAP = 200        // çª—å£é‡å 200å­—ç¬¦

  async process(
    fullText: string,
    initialContext: CardPackageState,
    aiService: AIService,
    onProgress: (state: ProcessState) => void
  ): Promise<CardPackageState> {

    let currentPosition = 0
    let accumulatedData = { ...initialContext }

    while (currentPosition < fullText.length) {
      // 1. æå–æ–‡æœ¬çª—å£ï¼ˆå¸¦é‡å ï¼‰
      const windowEnd = Math.min(
        currentPosition + this.WINDOW_SIZE,
        fullText.length
      )
      const textWindow = fullText.slice(currentPosition, windowEnd)

      // 2. æ„å»ºæç¤ºè¯
      const prompt = this.buildPrompt(
        textWindow,
        accumulatedData,
        currentPosition,
        fullText.length
      )

      // 3. è°ƒç”¨AI
      const response = await aiService.generateWithMetadata(
        prompt,
        accumulatedData
      )

      // 4. åˆå¹¶ç»“æœï¼ˆçº¯å‡½æ•°ï¼‰
      if (response.cards?.length > 0) {
        accumulatedData = mergeCardData(
          accumulatedData,
          this.convertToPackageData(response.cards),
          { deduplicateById: true, conflictStrategy: 'merge' }
        )
      }

      // 5. æ›´æ–°ä½ç½®ï¼ˆAIå‘Šè¯‰æˆ‘ä»¬å¤„ç†åˆ°å“ªäº†ï¼‰
      const nextPosition = response.metadata.nextShouldStartFrom
        || response.metadata.processedUpTo

      // 6. é˜²æ­»å¾ªç¯éªŒè¯
      if (nextPosition <= currentPosition) {
        console.warn('AIæœªèƒ½å‰è¿›ï¼Œè·³è¿‡1000å­—ç¬¦ç»§ç»­')
        currentPosition += 1000
      } else {
        currentPosition = nextPosition
      }

      // 7. è¿›åº¦å›è°ƒ
      onProgress({
        current: currentPosition,
        total: fullText.length,
        processedCards: this.countCards(accumulatedData)
      })
    }

    return accumulatedData
  }
}
```

**AIæç¤ºè¯æ ¼å¼ï¼ˆè¦æ±‚AIè¿”å›å¤„ç†ä½ç½®ï¼‰ï¼š**

```typescript
private buildPrompt(
  textWindow: string,
  context: CardPackageState,
  position: number,
  totalLength: number
): string {

  const isFirstChunk = position === 0

  if (isFirstChunk) {
    // é¦–æ¬¡ï¼šåŒ…å«å®Œæ•´æŒ‡å—
    return `
${AI_GUIDE_FULL_TEXT}  // æ¥è‡ªç°æœ‰çš„AIåˆ›ä½œæŒ‡å—

ã€æµå¼å¤„ç†è¯´æ˜ã€‘
è¿™æ˜¯ä¸€ä¸ªå¤§æ–‡æœ¬çš„æµå¼å¤„ç†ä»»åŠ¡ã€‚ä½ ä¼šåˆ†å¤šæ¬¡æ”¶åˆ°æ–‡æœ¬ç‰‡æ®µã€‚

ã€å…³é”®ã€‘ä½ å¿…é¡»åœ¨è¾“å‡ºä¸­æ ‡æ³¨ï¼šä½ å¤„ç†åˆ°äº†åŸæ–‡çš„ç¬¬å‡ ä¸ªå­—ç¬¦ã€‚

è¾“å‡ºæ ¼å¼ï¼ˆä¸¥æ ¼JSONï¼‰ï¼š
{
  "cards": [
    // è½¬æ¢çš„å¡ç‰Œæ•°ç»„
  ],
  "metadata": {
    "processedUpTo": <ä½ å¤„ç†åˆ°åŸæ–‡çš„ç¬¬å‡ ä¸ªå­—ç¬¦>,
    "lastProcessedText": "<æœ€åå¤„ç†çš„5-10ä¸ªå­—>",
    "nextShouldStartFrom": <å»ºè®®ä¸‹æ¬¡ä»ç¬¬å‡ ä¸ªå­—ç¬¦å¼€å§‹ï¼ˆå¯é€‰ï¼‰>,
    "confidence": "complete" | "partial"
  }
}

ã€æ–‡æœ¬å†…å®¹ã€‘ï¼ˆä½ç½® ${position}-${position + textWindow.length} / ${totalLength}ï¼‰
---
${textWindow}
---

è¯·è½¬æ¢è¿™æ®µæ–‡æœ¬ä¸­çš„å®Œæ•´å¡ç‰Œã€‚å¦‚æœé‡åˆ°æ˜æ˜¾è¢«æˆªæ–­çš„å¡ç‰Œï¼Œåœæ­¢å¤„ç†å¹¶æ ‡è®°processedUpToã€‚
`
  } else {
    // åç»­å—ï¼šç²¾ç®€æç¤ºï¼ˆå‡å°‘tokenæ¶ˆè€—ï¼‰
    return `
ã€ç»§ç»­å¤„ç†ã€‘
å½“å‰å·²è¯†åˆ«çš„customFieldDefinitionsï¼š
${JSON.stringify(context.customFieldDefinitions, null, 2)}

å·²å¤„ç†å¡ç‰Œæ•°ï¼š${this.countCards(context)}

ã€æ–‡æœ¬å†…å®¹ã€‘ï¼ˆä½ç½® ${position}-${position + textWindow.length} / ${totalLength}ï¼‰
---
${textWindow}
---

ç»§ç»­è½¬æ¢ï¼Œä¿æŒä¸ä¹‹å‰ç›¸åŒçš„æ ¼å¼å’Œè§„åˆ™ã€‚è¾“å‡ºæ ¼å¼åŒå‰ã€‚
`
  }
}
```

**å…³é”®è®¾è®¡ç‚¹ï¼š**

1. **é‡å çª—å£**ï¼šæ¯æ¬¡çª—å£åŒ…å«ä¸Šæ¬¡æœ«å°¾200å­—ç¬¦ï¼Œç¡®ä¿ä¸é—æ¼å¡ç‰Œ
2. **ä½ç½®éªŒè¯**ï¼šæ£€æŸ¥`processedUpTo`æ˜¯å¦åˆç†ï¼Œé˜²æ­¢æ­»å¾ªç¯
3. **å®¹é”™æœºåˆ¶**ï¼šå¦‚æœAIåœæ»ï¼Œå¼ºåˆ¶è·³è¿‡ä¸€æ®µç»§ç»­
4. **æœ€å¤§è¿­ä»£é™åˆ¶**ï¼šé˜²æ­¢æ— é™å¾ªç¯ï¼ˆå¦‚50æ¬¡ï¼‰

---

### 3.4 Tokenä¼˜åŒ–ç­–ç•¥ï¼ˆä¸ä¾èµ–Prompt Cachingï¼‰

**æŒ‘æˆ˜ï¼š** æ¯æ¬¡è°ƒç”¨éƒ½éœ€è¦å‘é€å®Œæ•´çš„AIåˆ›ä½œæŒ‡å—ï¼ˆçº¦3000 tokensï¼‰

**ä¼˜åŒ–ç­–ç•¥ï¼š**

#### ç­–ç•¥1ï¼šé¦–æ¬¡å®Œæ•´ + åç»­ç²¾ç®€

```typescript
// é¦–æ¬¡è°ƒç”¨ï¼šå®Œæ•´æŒ‡å—ï¼ˆ3000 tokensï¼‰
const firstPrompt = `
${AI_GUIDE_FULL_TEXT}  // å®Œæ•´çš„7éƒ¨åˆ†æŒ‡å—
...
`

// åç»­è°ƒç”¨ï¼šç²¾ç®€ç‰ˆï¼ˆ500 tokensï¼‰
const subsequentPrompt = `
ã€è§„åˆ™æ‘˜è¦ã€‘ä½ å·²é˜…è¯»å®Œæ•´æŒ‡å—ï¼Œç»§ç»­æŒ‰ä»¥ä¸‹æ ¸å¿ƒè§„åˆ™å¤„ç†ï¼š
1. ä¸¥æ ¼å­—æ®µæ˜ å°„
2. ä¿æŒåŸæ–‡æ ¼å¼
3. æ ‡è®°ä¸ç¡®å®šæ€§
4. è¿”å›processedUpToä½ç½®

å½“å‰ä¸Šä¸‹æ–‡ï¼š
${JSON.stringify(context.customFieldDefinitions)}

ã€æ–‡æœ¬ã€‘...
`
```

**èŠ‚çœï¼š** é¦–æ¬¡3000 tokensï¼Œåç»­æ¯æ¬¡500 tokens
**æˆæœ¬å¯¹æ¯”ï¼ˆ10æ¬¡è°ƒç”¨ï¼‰ï¼š**
- ä¸ä¼˜åŒ–ï¼š3000 Ã— 10 = 30,000 tokens
- ä¼˜åŒ–åï¼š3000 + 500 Ã— 9 = 7,500 tokensï¼ˆèŠ‚çœ75%ï¼‰

#### ç­–ç•¥2ï¼šæŒ‡å—å‹ç¼©

å°†AIåˆ›ä½œæŒ‡å—å‹ç¼©ä¸ºæ ¸å¿ƒè§„åˆ™è¡¨ï¼š

```typescript
const COMPRESSED_GUIDE = `
æ ¸å¿ƒè§„åˆ™è¡¨ï¼š
- æ–½æ³•å±æ€§ï¼šä»…é™ åŠ›é‡/æ•æ·/çµå·§/é£åº¦/æœ¬èƒ½/çŸ¥è¯†/ä¸å¯æ–½æ³•
- å­èŒä¸šç­‰çº§ï¼šä»…é™ åŸºçŸ³/ä¸“ç²¾/å¤§å¸ˆ
- ç§æ—å¡ï¼šæ¯ç§æ—2å¼ ï¼Œç±»åˆ«åˆ†åˆ«ä¸º1å’Œ2
- æ•°å€¼å­—æ®µï¼šå¿…é¡»æ˜¯Numberç±»å‹
- IDæ ¼å¼ï¼šåŒ…å-ä½œè€…-ç±»å‹-æ ‡è¯†

å®Œæ•´è§„èŒƒè§é¦–æ¬¡è°ƒç”¨ã€‚
`
```

#### ç­–ç•¥3ï¼šåŠ¨æ€ä¸Šä¸‹æ–‡è£å‰ª

åªä¼ é€’å½“å‰ç›¸å…³çš„customFieldDefinitionsï¼š

```typescript
// å¦‚æœå½“å‰çª—å£åªåŒ…å«èŒä¸šå¡ï¼Œåªä¼ é€’professionså’Œdomainså®šä¹‰
const relevantContext = {
  professions: context.customFieldDefinitions.professions,
  domains: context.customFieldDefinitions.domains
  // çœç•¥å…¶ä»–æ— å…³å®šä¹‰
}
```

---

### 3.5 é”™è¯¯å¤„ç†ä¸å®¹é”™æœºåˆ¶

#### æ­»å¾ªç¯é˜²æŠ¤

```typescript
let iterationCount = 0
const MAX_ITERATIONS = 50  // æœ€å¤šè¿­ä»£50æ¬¡

while (currentPosition < fullText.length && iterationCount < MAX_ITERATIONS) {
  iterationCount++

  // ... å¤„ç†é€»è¾‘

  // æ£€æµ‹åœæ»
  if (nextPosition <= currentPosition) {
    console.warn(`[Iteration ${iterationCount}] AIåœæ»ï¼Œå¼ºåˆ¶è·³è¿‡`)
    currentPosition += 1000  // å¼ºåˆ¶å‰è¿›
  }
}

if (iterationCount >= MAX_ITERATIONS) {
  throw new Error('è¶…è¿‡æœ€å¤§è¿­ä»£æ¬¡æ•°ï¼Œå¯èƒ½å­˜åœ¨æ ¼å¼é—®é¢˜')
}
```

#### ä½ç½®éªŒè¯

```typescript
// éªŒè¯AIè¿”å›çš„ä½ç½®æ˜¯å¦åˆç†
if (response.metadata.processedUpTo > fullText.length) {
  console.error('AIè¿”å›çš„ä½ç½®è¶…å‡ºæ–‡æœ¬é•¿åº¦')
  // ä½¿ç”¨çª—å£æœ«å°¾ä½œä¸ºåå¤‡
  nextPosition = windowEnd
}

// éªŒè¯æ˜¯å¦æœ‰è¿›å±•
if (response.cards.length === 0 && nextPosition === currentPosition) {
  console.warn('æœªäº§ç”Ÿæ–°å¡ç‰Œä¸”æœªå‰è¿›')
  // å¯èƒ½é‡åˆ°æ— æ³•è¯†åˆ«çš„å†…å®¹ï¼Œè·³è¿‡ä¸€æ®µ
}
```

#### APIè°ƒç”¨å¤±è´¥é‡è¯•

```typescript
async function callAIWithRetry(
  prompt: string,
  maxRetries = 3
): Promise<AIChunkResponse> {

  for (let i = 0; i < maxRetries; i++) {
    try {
      return await aiService.generateWithMetadata(prompt, context)
    } catch (error) {
      console.error(`è°ƒç”¨å¤±è´¥ (${i + 1}/${maxRetries}):`, error)

      if (i === maxRetries - 1) throw error

      // ç­‰å¾…åé‡è¯•
      await sleep(2000 * (i + 1))  // æŒ‡æ•°é€€é¿
    }
  }
}
```

---

## å››ã€å®Œæ•´æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç²˜è´´å¤§æ–‡æœ¬   â”‚ (20,000å­—ç¬¦)
â”‚ "èŒä¸šå¡ï¼šå‰‘å®¢..."â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FileProcessor.extractText()              â”‚
â”‚ æå–çº¯æ–‡æœ¬                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ StreamingBatchProcessor.process()        â”‚
â”‚                                          â”‚
â”‚  currentPosition = 0                     â”‚
â”‚  accumulatedData = initialContext        â”‚
â”‚                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ LOOP (while æœªå¤„ç†å®Œ)             â”‚   â”‚
â”‚  â”‚                                   â”‚   â”‚
â”‚  â”‚ 1. æå–çª—å£ [0-6000]             â”‚   â”‚
â”‚  â”‚    textWindow = text[0:6000]     â”‚   â”‚
â”‚  â”‚                                   â”‚   â”‚
â”‚  â”‚ 2. è°ƒç”¨AI                         â”‚   â”‚
â”‚  â”‚    prompt = buildPrompt(...)     â”‚   â”‚
â”‚  â”‚    response = ai.generate(...)   â”‚   â”‚
â”‚  â”‚                                   â”‚   â”‚
â”‚  â”‚ 3. AIè¿”å›                         â”‚   â”‚
â”‚  â”‚    {                              â”‚   â”‚
â”‚  â”‚      cards: [èŒä¸šå¡1, èŒä¸šå¡2],  â”‚   â”‚
â”‚  â”‚      metadata: {                 â”‚   â”‚
â”‚  â”‚        processedUpTo: 5800,      â”‚   â”‚
â”‚  â”‚        lastProcessedText: "...é˜²å¾¡"â”‚   â”‚
â”‚  â”‚      }                            â”‚   â”‚
â”‚  â”‚    }                              â”‚   â”‚
â”‚  â”‚                                   â”‚   â”‚
â”‚  â”‚ 4. åˆå¹¶ç»“æœ                       â”‚   â”‚
â”‚  â”‚    accumulatedData = merge(      â”‚   â”‚
â”‚  â”‚      accumulatedData,            â”‚   â”‚
â”‚  â”‚      response.cards              â”‚   â”‚
â”‚  â”‚    )                              â”‚   â”‚
â”‚  â”‚                                   â”‚   â”‚
â”‚  â”‚ 5. æ›´æ–°ä½ç½®                       â”‚   â”‚
â”‚  â”‚    currentPosition = 5800        â”‚   â”‚
â”‚  â”‚                                   â”‚   â”‚
â”‚  â”‚ 6. ä¸‹ä¸€è½®                         â”‚   â”‚
â”‚  â”‚    æå–çª—å£ [5800-11800]         â”‚   â”‚
â”‚  â”‚    ...                            â”‚   â”‚
â”‚  â”‚                                   â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                          â”‚
â”‚  æœ€ç»ˆ: accumulatedData åŒ…å«æ‰€æœ‰å¡ç‰Œ      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ValidationService.validatePackage()      â”‚
â”‚ éªŒè¯å®Œæ•´æ€§å’Œè§„èŒƒæ€§                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UIé¢„è§ˆå±‚                                 â”‚
â”‚ - æ˜¾ç¤ºæ‰€æœ‰å¡ç‰Œï¼ˆå¯å‹¾é€‰ï¼‰                  â”‚
â”‚ - æ˜¾ç¤ºè­¦å‘Š/é”™è¯¯                           â”‚
â”‚ - ç”¨æˆ·ç¡®è®¤                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CardEditorStore                          â”‚
â”‚ åˆå¹¶åˆ°ç°æœ‰å¡åŒ…ï¼Œå®Œæˆå¯¼å…¥                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## äº”ã€æ–‡ä»¶ç»“æ„è§„åˆ’

```
app/card-editor/
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ ai-service.ts                    # AIæœåŠ¡ï¼ˆOpenAIå…¼å®¹ï¼‰
â”‚   â”œâ”€â”€ ai-prompt-builder.ts             # æç¤ºè¯æ„å»ºå™¨
â”‚   â”œâ”€â”€ json-merger.ts                   # JSONåˆå¹¶çº¯å‡½æ•° â­æ ¸å¿ƒ
â”‚   â”œâ”€â”€ streaming-batch-processor.ts     # æµå¼æ‰¹é‡å¤„ç†å™¨ â­æ ¸å¿ƒ
â”‚   â”œâ”€â”€ result-parser.ts                 # AIè¾“å‡ºè§£æå™¨
â”‚   â”œâ”€â”€ file-processor.ts                # æ–‡ä»¶æ–‡æœ¬æå–
â”‚   â””â”€â”€ api-key-manager.ts               # API Keyå®‰å…¨ç®¡ç†
â”‚
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ai-assistant-dialog.tsx          # AIåŠ©æ‰‹ä¸»å¯¹è¯æ¡†
â”‚   â”œâ”€â”€ ai-config-settings.tsx           # APIé…ç½®ç•Œé¢
â”‚   â”œâ”€â”€ ai-upload-step.tsx               # ä¸Šä¼ /ç²˜è´´ç•Œé¢
â”‚   â”œâ”€â”€ ai-processing-step.tsx           # å¤„ç†è¿›åº¦ç•Œé¢
â”‚   â””â”€â”€ ai-preview-step.tsx              # é¢„è§ˆç¡®è®¤ç•Œé¢
â”‚
â””â”€â”€ types/
    â””â”€â”€ ai-types.ts                       # AIç›¸å…³ç±»å‹å®šä¹‰
```

---

## å…­ã€API Keyå®‰å…¨ç®¡ç†

**æ–‡ä»¶ï¼š** `app/card-editor/services/api-key-manager.ts`

```typescript
class APIKeyManager {
  private readonly STORAGE_KEY = 'dh_ai_config'

  // ä¿å­˜é…ç½®ï¼ˆåŠ å¯†ï¼‰
  async saveConfig(config: AIServiceConfig): Promise<void> {
    const encrypted = await this.encrypt(JSON.stringify(config))
    localStorage.setItem(this.STORAGE_KEY, encrypted)
  }

  // è¯»å–é…ç½®ï¼ˆè§£å¯†ï¼‰
  async loadConfig(): Promise<AIServiceConfig | null> {
    const encrypted = localStorage.getItem(this.STORAGE_KEY)
    if (!encrypted) return null

    const decrypted = await this.decrypt(encrypted)
    return JSON.parse(decrypted)
  }

  // ä½¿ç”¨Web Crypto APIåŠ å¯†
  private async encrypt(data: string): Promise<string> {
    const key = await this.getDeviceKey()
    const encoder = new TextEncoder()
    const dataBuffer = encoder.encode(data)

    const iv = crypto.getRandomValues(new Uint8Array(12))
    const encryptedBuffer = await crypto.subtle.encrypt(
      { name: 'AES-GCM', iv },
      key,
      dataBuffer
    )

    // è¿”å› IV + å¯†æ–‡ çš„Base64
    const combined = new Uint8Array(iv.length + encryptedBuffer.byteLength)
    combined.set(iv)
    combined.set(new Uint8Array(encryptedBuffer), iv.length)

    return btoa(String.fromCharCode(...combined))
  }

  // åŸºäºè®¾å¤‡æŒ‡çº¹ç”Ÿæˆå¯†é’¥
  private async getDeviceKey(): Promise<CryptoKey> {
    const fingerprint = `${navigator.userAgent}-${screen.width}x${screen.height}`
    const encoder = new TextEncoder()
    const data = encoder.encode(fingerprint)
    const hash = await crypto.subtle.digest('SHA-256', data)

    return crypto.subtle.importKey(
      'raw',
      hash,
      { name: 'AES-GCM' },
      false,
      ['encrypt', 'decrypt']
    )
  }
}
```

---

## ä¸ƒã€å®ç°ä¼˜å…ˆçº§ï¼ˆåˆ†é˜¶æ®µï¼‰

### Phase 1 - æ ¸å¿ƒåŠŸèƒ½ï¼ˆMVPï¼‰

**ç›®æ ‡ï¼š** éªŒè¯æµå¼å¤„ç†æ¶æ„å¯è¡Œæ€§

1. âœ… JSONåˆå¹¶å‡½æ•°ï¼ˆå«å•å…ƒæµ‹è¯•ï¼‰
2. âœ… AIæœåŠ¡å±‚ï¼ˆOpenAIå…¼å®¹ï¼‰
3. âœ… æµå¼æ‰¹é‡å¤„ç†å™¨ï¼ˆåŸºç¡€ç‰ˆï¼‰
4. âœ… ç®€å•çš„UIï¼ˆç²˜è´´æ–‡æœ¬ â†’ å¤„ç† â†’ é¢„è§ˆï¼‰
5. âœ… API Keyé…ç½®é¡µé¢

**éªŒæ”¶æ ‡å‡†ï¼š**
- èƒ½å¤„ç†5000å­—ç¬¦ä»¥å†…çš„æ–‡æœ¬
- èƒ½æ­£ç¡®åˆ†å—å¹¶åˆå¹¶ç»“æœ
- èƒ½æ˜¾ç¤ºå¤„ç†è¿›åº¦

### Phase 2 - å¤§æ–‡æœ¬å¤„ç†ä¼˜åŒ–

**ç›®æ ‡ï¼š** æ”¯æŒå‡ ä¸‡å­—çš„å¤§æ–‡æœ¬

1. âœ… æ»‘åŠ¨çª—å£æœºåˆ¶
2. âœ… ä½ç½®éªŒè¯ä¸æ­»å¾ªç¯é˜²æŠ¤
3. âœ… Tokenä¼˜åŒ–ï¼ˆç²¾ç®€åç»­æç¤ºï¼‰
4. âœ… é”™è¯¯é‡è¯•æœºåˆ¶
5. âœ… è¯¦ç»†çš„è¿›åº¦æ˜¾ç¤ºï¼ˆåˆ†å—è¿›åº¦ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼š**
- èƒ½å¤„ç†20,000å­—ç¬¦ä»¥ä¸Šçš„æ–‡æœ¬
- å¤„ç†å¤±è´¥æ—¶æœ‰æ˜ç¡®æç¤º
- è¿›åº¦æ˜¾ç¤ºå‡†ç¡®

### Phase 3 - ç”¨æˆ·ä½“éªŒå¢å¼º

**ç›®æ ‡ï¼š** æå‡å¯ç”¨æ€§å’Œå®¹é”™æ€§

1. âœ… æ–‡ä»¶ä¸Šä¼ æ”¯æŒï¼ˆ.txt/.mdï¼‰
2. âœ… é¢„è§ˆç•Œé¢ä¼˜åŒ–ï¼ˆå¯æŠ˜å ã€å¯ç¼–è¾‘ï¼‰
3. âœ… è­¦å‘Š/é”™è¯¯å¯è§†åŒ–
4. âœ… é€‰æ‹©æ€§å¯¼å…¥ï¼ˆå‹¾é€‰æ¡†ï¼‰
5. âœ… å¤šAIæä¾›å•†æ”¯æŒï¼ˆé…ç½®ç•Œé¢ï¼‰

**éªŒæ”¶æ ‡å‡†ï¼š**
- ç”¨æˆ·ä½“éªŒæµç•…
- é”™è¯¯ä¿¡æ¯æ¸…æ™°æ˜“æ‡‚
- æ”¯æŒä¸»æµAIæä¾›å•†

### Phase 4 - é«˜çº§åŠŸèƒ½ï¼ˆå¯é€‰ï¼‰

1. ğŸ”„ å¤„ç†å†å²è®°å½•
2. ğŸ”„ æ–‡æœ¬æ¨¡æ¿åº“
3. ğŸ”„ æ‰¹é‡é‡è¯•å¤±è´¥çš„å—
4. ğŸ”„ å¯¼å‡ºå¤„ç†æŠ¥å‘Š

---

## å…«ã€æ€§èƒ½ä¸æˆæœ¬ä¼°ç®—

### 8.1 Tokenæ¶ˆè€—ä¼°ç®—

**å‡è®¾ï¼š**
- AIåˆ›ä½œæŒ‡å—ï¼š3,000 tokens
- ç”¨æˆ·æ–‡æœ¬ï¼š20,000å­—ç¬¦ â‰ˆ 6,000 tokens
- åˆ†å—ç­–ç•¥ï¼š6,000å­—ç¬¦/å— â‰ˆ 2,000 tokens/å—
- æ€»å…±éœ€è¦ï¼š4å—

**æˆæœ¬è®¡ç®—ï¼ˆä½¿ç”¨ä¼˜åŒ–åçš„æç¤ºè¯ï¼‰ï¼š**

| å— | ç³»ç»Ÿæç¤º | ç”¨æˆ·æ–‡æœ¬ | è¾“å‡º | æ€»è®¡ |
|----|---------|---------|------|------|
| 1 | 3,000 | 2,000 | 1,500 | 6,500 |
| 2 | 500 | 2,000 | 1,500 | 4,000 |
| 3 | 500 | 2,000 | 1,500 | 4,000 |
| 4 | 500 | 2,000 | 1,500 | 4,000 |
| **åˆè®¡** | | | | **18,500 tokens** |

**ä»·æ ¼å‚è€ƒï¼ˆä»¥GPT-4oä¸ºä¾‹ï¼‰ï¼š**
- è¾“å…¥ï¼š$2.5/1M tokens
- è¾“å‡ºï¼š$10/1M tokens
- å•æ¬¡20Kå­—ç¬¦æ–‡æœ¬è½¬æ¢æˆæœ¬ï¼šçº¦ $0.03 USD

### 8.2 æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | ç›®æ ‡å€¼ |
|------|--------|
| å°æ–‡æœ¬å¤„ç†ï¼ˆ<5Kå­—ç¬¦ï¼‰ | < 30ç§’ |
| ä¸­æ–‡æœ¬å¤„ç†ï¼ˆ5K-15Kï¼‰ | < 90ç§’ |
| å¤§æ–‡æœ¬å¤„ç†ï¼ˆ15K-30Kï¼‰ | < 3åˆ†é’Ÿ |
| æœ€å¤§æ”¯æŒæ–‡æœ¬é•¿åº¦ | 50Kå­—ç¬¦ï¼ˆçº¦25æ¬¡è¿­ä»£ï¼‰ |

---

## ä¹ã€é£é™©ä¸ç¼“è§£ç­–ç•¥

| é£é™© | å½±å“ | ç¼“è§£ç­–ç•¥ |
|------|------|---------|
| AIè¿”å›ä½ç½®ä¸å‡†ç¡® | é—æ¼å¡ç‰Œ | é‡å çª—å£æœºåˆ¶ + ä½ç½®éªŒè¯ |
| APIè°ƒç”¨å¤±è´¥ | å¤„ç†ä¸­æ–­ | é‡è¯•æœºåˆ¶ + ä¿ç•™è¾“å…¥ |
| æ­»å¾ªç¯ | ç”¨æˆ·ç­‰å¾…è¶…æ—¶ | æœ€å¤§è¿­ä»£é™åˆ¶ + å¼ºåˆ¶è·³è¿‡ |
| Tokenæˆæœ¬è¿‡é«˜ | ç”¨æˆ·è´Ÿæ‹…é‡ | æç¤ºè¯ä¼˜åŒ– + æˆæœ¬ä¼°ç®—æç¤º |
| ä¸åŒAIæ¨¡å‹å…¼å®¹æ€§ | è¾“å‡ºæ ¼å¼ä¸ä¸€è‡´ | ä¸¥æ ¼çš„JSON Schema + è¾“å‡ºéªŒè¯ |

---

## åã€åç»­æ”¹è¿›æ–¹å‘

1. **æ™ºèƒ½åˆ†å—ä¼˜åŒ–**
   - ä½¿ç”¨AIé¢„åˆ†ææ–‡æœ¬ï¼Œç»™å‡ºæœ€ä¼˜åˆ†å—ç‚¹
   - æŒ‰å¡ç‰Œç±»å‹è‡ªåŠ¨åˆ†ç»„

2. **å¢é‡å¼å¤„ç†**
   - æ”¯æŒ"æš‚åœ/ç»§ç»­"åŠŸèƒ½
   - å¤„ç†åˆ°ä¸€åŠå¯ä»¥ä¿å­˜è¿›åº¦

3. **å¤šæ¨¡å‹å¯¹æ¯”**
   - åŒä¸€æ–‡æœ¬ç”¨ä¸åŒæ¨¡å‹å¤„ç†
   - å¯¹æ¯”ç»“æœè´¨é‡

4. **æœ¬åœ°ç¼“å­˜**
   - ç¼“å­˜å·²å¤„ç†çš„æ–‡æœ¬ç‰‡æ®µ
   - ç›¸ä¼¼å†…å®¹å¿«é€Ÿå¤ç”¨

---

## åä¸€ã€æ€»ç»“

### æ ¸å¿ƒä¼˜åŠ¿

1. âœ… **æ¶æ„æ¸…æ™°**ï¼šåˆ†å±‚æ˜ç¡®ï¼ŒèŒè´£å•ä¸€
2. âœ… **å…¼å®¹æ€§å¼º**ï¼šå®Œå…¨åŸºäºOpenAIæ ‡å‡†ï¼Œæ”¯æŒå¤šç§AI
3. âœ… **å¯æµ‹è¯•æ€§é«˜**ï¼šæ ¸å¿ƒé€»è¾‘ä¸ºçº¯å‡½æ•°
4. âœ… **å®¹é”™æ€§å¥½**ï¼šå¤šé‡é˜²æŠ¤æœºåˆ¶
5. âœ… **æˆæœ¬å¯æ§**ï¼šTokenä¼˜åŒ–ç­–ç•¥

### å®ç°å…³é”®ç‚¹

1. **JSONåˆå¹¶çº¯å‡½æ•°** - æ•´ä¸ªæ¶æ„çš„åŸºçŸ³
2. **AIè‡ªä¸»åˆ†èŠ‚** - æ¯”é¢„è®¾è§„åˆ™æ›´æ™ºèƒ½
3. **æ»‘åŠ¨çª—å£ + ä½ç½®éªŒè¯** - ç¡®ä¿ä¸é—æ¼
4. **æç¤ºè¯ä¼˜åŒ–** - æ§åˆ¶æˆæœ¬
5. **æµå¼è¿›åº¦åé¦ˆ** - æå‡ç”¨æˆ·ä½“éªŒ

### ä¸‹ä¸€æ­¥

ä¸å›¢é˜Ÿè®¨è®ºUIå±‚çš„è¯¦ç»†è®¾è®¡ï¼ŒåŒ…æ‹¬ï¼š
- é…ç½®ç•Œé¢çš„äº¤äº’æµç¨‹
- é¢„è§ˆç•Œé¢çš„è¯¦ç»†ç¨‹åº¦
- é”™è¯¯å¤„ç†çš„ç”¨æˆ·åé¦ˆæ–¹å¼
- å¢é‡å¯¼å…¥çš„åˆå¹¶ç­–ç•¥

---

**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æœ€åæ›´æ–°ï¼š** 2025-01-04
**ä½œè€…ï¼š** Claude + ç”¨æˆ·åä½œè®¾è®¡
