<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ— é™å¾ªç¯ä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .success {
            background-color: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .warning {
            background-color: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .error {
            background-color: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .info {
            background-color: #d1ecf1;
            border-color: #17a2b8;
            color: #0c5460;
        }
        .code {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
        .step {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .step h3 {
            margin-top: 0;
            color: #333;
        }
        .btn {
            display: inline-block;
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            margin: 5px;
            border: none;
            cursor: pointer;
        }
        .btn:hover {
            background-color: #0056b3;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ DaggerHeart æ— é™å¾ªç¯ä¿®å¤éªŒè¯</h1>
    
    <div class="status info">
        <strong>ä¿®å¤æ€»ç»“:</strong><br>
        å·²è¯†åˆ«å¹¶ä¿®å¤äº†å¯¼è‡´ "Maximum update depth exceeded" é”™è¯¯çš„æ— é™å¾ªç¯é—®é¢˜ã€‚
    </div>

    <div class="step">
        <h3>ğŸ› åŸé—®é¢˜åˆ†æ</h3>
        <p><strong>é—®é¢˜æ ¹æº:</strong> èšç„¦å¡ç‰ŒçŠ¶æ€åœ¨å¤šä¸ªç»„ä»¶é—´å½¢æˆå¾ªç¯æ›´æ–°ï¼š</p>
        <div class="code">
CardDeckSection (é€‰æ‹©å¡ç‰Œ) 
  â†“ onFocusedCardsChange
CharacterSheetPageTwo (å¤„ç†å˜æ›´) 
  â†“ è°ƒç”¨çˆ¶ç»„ä»¶å›è°ƒ
App.tsx (æ›´æ–°formData) 
  â†“ formData.focused_card_idså˜æ›´
CardDisplaySection (å“åº”å˜æ›´) 
  â†“ propså˜åŒ–è§¦å‘é‡æ–°æ¸²æŸ“
CardDeckSection (é‡æ–°åˆå§‹åŒ–é€‰æ‹©) 
  â†“ å½¢æˆæ— é™å¾ªç¯...
        </div>
    </div>

    <div class="step">
        <h3>ğŸ› ï¸ ä¿®å¤æªæ–½</h3>
        <h4>1. App.tsx ä¸»ç»„ä»¶ä¿®å¤</h4>
        <ul>
            <li><strong>æ·±åº¦æ¯”è¾ƒ:</strong> åœ¨ handleFocusedCardsChange ä¸­æ·»åŠ æ·±åº¦æ¯”è¾ƒï¼Œé¿å…ç›¸åŒæ•°æ®çš„é‡å¤æ›´æ–°</li>
            <li><strong>ä¼˜åŒ–è‡ªåŠ¨ä¿å­˜:</strong> å¢åŠ ä¿å­˜å‰çš„æ•°æ®å¯¹æ¯”ï¼Œåªæœ‰çœŸæ­£å˜æ›´æ—¶æ‰ä¿å­˜</li>
            <li><strong>å¢åŠ é˜²æŠ–æ—¶é—´:</strong> ä»500mså¢åŠ åˆ°1000msï¼Œå‡å°‘é¢‘ç¹ä¿å­˜</li>
        </ul>

        <h4>2. CharacterSheetPageTwo ä¿®å¤</h4>
        <ul>
            <li><strong>ç§»é™¤åŒé‡æ›´æ–°:</strong> handleFocusedCardsChange åªé€šçŸ¥çˆ¶ç»„ä»¶ï¼Œä¸ç›´æ¥æ›´æ–° formData</li>
        </ul>

        <h4>3. CardDisplaySection ä¿®å¤</h4>
        <ul>
            <li><strong>ä½¿ç”¨ useRef é˜²å¾ªç¯:</strong> ä½¿ç”¨ lastFocusedCardIdsRef è®°å½•ä¸Šæ¬¡çš„çŠ¶æ€</li>
            <li><strong>ç²¾ç¡®å˜æ›´æ£€æµ‹:</strong> åªæœ‰åœ¨ focusedCardIds çœŸæ­£å˜åŒ–æ—¶æ‰æ›´æ–°</li>
            <li><strong>ç§»é™¤äº‹ä»¶ç›‘å¬å™¨:</strong> ä¸å†ä½¿ç”¨å…¨å±€ focusedCardsChanged äº‹ä»¶</li>
        </ul>

        <h4>4. CardDeckSection ä¿®å¤</h4>
        <ul>
            <li><strong>å¾ªç¯æ£€æµ‹æ ‡å¿—:</strong> ä½¿ç”¨ isUpdatingFromPropsRef é˜²æ­¢ props â†’ state â†’ props å¾ªç¯</li>
            <li><strong>ç²¾ç¡®çŠ¶æ€æ¯”è¾ƒ:</strong> æ·±åº¦æ¯”è¾ƒ selectedCards å’Œ focusedCardIdsï¼Œé¿å…ä¸å¿…è¦çš„æ›´æ–°</li>
        </ul>
    </div>

    <div class="step">
        <h3>ğŸ§ª éªŒè¯æ­¥éª¤</h3>
        <p>è¯·æŒ‰ä»¥ä¸‹æ­¥éª¤éªŒè¯ä¿®å¤æ•ˆæœï¼š</p>
        
        <div class="status warning">
            <strong>é‡è¦:</strong> åœ¨æµ‹è¯•å‰è¯·å…ˆæ¸…ç†æµè§ˆå™¨ç¼“å­˜å’Œ localStorage æ•°æ®ä»¥ç¡®ä¿å¹²å‡€çš„æµ‹è¯•ç¯å¢ƒã€‚
        </div>

        <ol>
            <li>
                <strong>æ¸…ç†æµ‹è¯•ç¯å¢ƒ</strong>
                <div class="code">
// åœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…· Console ä¸­æ‰§è¡Œï¼š
localStorage.clear();
location.reload();
                </div>
            </li>
            
            <li>
                <strong>å¯åŠ¨å¼€å‘æœåŠ¡å™¨</strong>
                <button class="btn" onclick="window.open('http://localhost:3001', '_blank')">
                    æ‰“å¼€åº”ç”¨ (localhost:3001)
                </button>
            </li>
            
            <li>
                <strong>æµ‹è¯•èšç„¦å¡ç‰ŒåŠŸèƒ½</strong>
                <ul>
                    <li>è¿›å…¥"ç¬¬äºŒé¡µ"æ ‡ç­¾</li>
                    <li>åœ¨å¡ç‰Œç»„åŒºåŸŸæŒ‰ä½ Alt é”®å¹¶ç‚¹å‡»ä¸€äº›å¡ç‰Œ</li>
                    <li>è§‚å¯Ÿå·¦ä¾§å¡ç‰Œå±•ç¤ºåŒºçš„"èšç„¦"æ ‡ç­¾é¡µ</li>
                    <li>æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°æ˜¯å¦æœ‰é‡å¤çš„æ—¥å¿—è¾“å‡º</li>
                </ul>
            </li>
            
            <li>
                <strong>æµ‹è¯•è§’è‰²åˆ‡æ¢åŠŸèƒ½</strong>
                <ul>
                    <li>è¿›å…¥"è§’è‰²ç®¡ç†"æ ‡ç­¾</li>
                    <li>åˆ›å»ºæ–°å­˜æ¡£</li>
                    <li>åœ¨ä¸åŒå­˜æ¡£é—´åˆ‡æ¢</li>
                    <li>éªŒè¯èšç„¦å¡ç‰ŒçŠ¶æ€æ˜¯å¦æ­£ç¡®ä¿å­˜å’Œæ¢å¤</li>
                </ul>
            </li>
        </ol>
    </div>

    <div class="step">
        <h3>âœ… æœŸæœ›ç»“æœ</h3>
        <div class="status success">
            <strong>æˆåŠŸæ ‡å¿—:</strong>
            <ul>
                <li>ä¸å†å‡ºç° "Maximum update depth exceeded" é”™è¯¯</li>
                <li>æ§åˆ¶å°æ—¥å¿—ä¸å†é‡å¤è¾“å‡ºç›¸åŒå†…å®¹</li>
                <li>èšç„¦å¡ç‰ŒåŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
                <li>è§’è‰²åˆ‡æ¢åŠŸèƒ½æ­£å¸¸å·¥ä½œ</li>
                <li>è‡ªåŠ¨ä¿å­˜åŠŸèƒ½æ­£å¸¸å·¥ä½œä¸”ä¸é¢‘ç¹è§¦å‘</li>
            </ul>
        </div>
    </div>

    <div class="step">
        <h3>ğŸ” ç›‘æ§æŒ‡æ ‡</h3>
        <p>æµ‹è¯•æ—¶è¯·å…³æ³¨ä»¥ä¸‹æ§åˆ¶å°è¾“å‡ºæ¨¡å¼ï¼š</p>
        
        <h4>æ­£å¸¸æ¨¡å¼ (ä¿®å¤å):</h4>
        <div class="code">
[App] èšç„¦å¡ç‰Œå˜æ›´: 0 -> 2
[CardDisplaySection] æ›´æ–°èšç„¦å¡ç‰Œï¼Œå…± 2 å¼ 
[App] Auto-saved character: xxx-xxx-xxx
        </div>

        <h4>å¼‚å¸¸æ¨¡å¼ (éœ€è¦ç»§ç»­ä¿®å¤):</h4>
        <div class="code">
[App] èšç„¦å¡ç‰Œå˜æ›´: 0 -> 2
[App] èšç„¦å¡ç‰Œå˜æ›´: 0 -> 2
[CardDisplaySection] æ›´æ–°èšç„¦å¡ç‰Œï¼Œå…± 2 å¼ 
[App] èšç„¦å¡ç‰Œå˜æ›´: 2 -> 0
[App] èšç„¦å¡ç‰Œå˜æ›´: 2 -> 0
... (æ— é™é‡å¤)
        </div>
    </div>

    <div class="status info">
        <strong>æ³¨æ„:</strong> å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œå¯èƒ½éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥ React Strict Mode æˆ–å…¶ä»–ç»„ä»¶çš„çŠ¶æ€ç®¡ç†é€»è¾‘ã€‚
    </div>

    <div style="text-align: center; margin-top: 30px;">
        <button class="btn" onclick="window.location.reload()">åˆ·æ–°é¡µé¢</button>
        <button class="btn btn-danger" onclick="if(confirm('ç¡®å®šè¦æ¸…ç†æ‰€æœ‰ localStorage æ•°æ®å—ï¼Ÿ')) { localStorage.clear(); alert('å·²æ¸…ç†'); }">
            æ¸…ç† localStorage
        </button>
    </div>
</body>
</html>
